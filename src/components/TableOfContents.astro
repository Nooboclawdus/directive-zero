---
// Auto-generated table of contents from headings
// Usage: <TableOfContents headings={headings} />
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
  maxDepth?: number;
}

const { headings, maxDepth = 3 } = Astro.props;
const filtered = headings.filter(h => h.depth >= 2 && h.depth <= maxDepth);
---

{filtered.length > 3 && (
  <details class="toc-wrapper mb-8 border border-[var(--color-border)] rounded-lg bg-[var(--color-bg-secondary)]" open>
    <summary class="cursor-pointer px-5 py-3 font-[var(--font-heading)] text-xs tracking-widest uppercase text-[var(--color-cyan)] hover:text-white transition-colors select-none flex items-center gap-2">
      <svg class="w-4 h-4 toc-chevron transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      Sommaire
    </summary>
    <nav class="px-5 pb-4">
      <ul class="space-y-1 text-sm">
        {filtered.map(h => (
          <li style={`padding-left: ${(h.depth - 2) * 1}rem`}>
            <a
              href={`#${h.slug}`}
              class:list={[
                'block py-0.5 text-[var(--color-text-secondary)] hover:text-[var(--color-crimson)] transition-colors',
                h.depth === 2 ? 'font-medium' : 'text-xs opacity-80'
              ]}
            >
              {h.text}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </details>
)}

<style>
  .toc-wrapper[open] .toc-chevron {
    transform: rotate(90deg);
  }
</style>
